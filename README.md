# Syncer

## Приложение app.ts
Это приложение эмулирует работу нашего магазина.
1) Приложение вечно генерирует покупателей и вставляет их в БД.
2) Для генерации используется библиотека Faker.
3) Покупатели создаются случайными пачками по 1 - 10 покупателей каждые 200 миллисекунд, и так же пачками вставляются в коллекцию customers.

## Приложение sync.ts
Это приложение копирует и анонимизирует покупателей.
1) Приложение “слушает” появление и изменение документов в коллекции customers и анонимизирует их:
   1) Заменяются содержимое полей firstName, lastName, часть до @ в поле email, address.line1, address.line2 и postcode. 
   2) Значения заменяются на 8-значную случайную, но детерминированную последовательность символов [a-zA-Z\\d]. 
2) После анонимизации записи вставляются в customers_anonymised следующим образом:
   1) Приложение накапливает пачки по 1,000 документов. 
   2) Если не удалось накопить пачку за 1 секунду, то вставляется то что есть.
3) Приложение может быть перезапущено. В случае перезапуска оно должно продолжить с того места где остановилось, не пропустив те изменения, которые случились пока приложение было оффлайн. 
4) Приложение можно запустить в двух режимах:
   1) Реалтайм синхронизация. Это дефолтное поведение, которое описано выше. Оно работает, если sync.ts запущен без аргументов. 
   2) Полная синхронизация. Включается, при наличии флага --full-reindex. В этом режиме приложение вместо того чтобы слушать изменения, должно запуститься и перелить все данные пачками по 1000 документов, анонимизировов их. В случае успеха, приложение завершает свою работу с кодом 0. (КУРСОР)
5) Оба режима могут работать параллельно. То есть одновременно можно запустить два инстанса — один в реалтайме, второй в режиме полной синхронизации.
6) Документы в коллекции customers не удаляются, не стоит предусматривать поведение на этот случай.

Для запуска проекта необходимо:
1) mongodb

Для это в .env нужно подставить соответствующие значения.

### Команды
`start:app` - Запускает приложение по генерации Customers

`start:sync` - Запускает реалтайм синхронизацию

`start:full-sync` - Запускает полную синхронизацию
